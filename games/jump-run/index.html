<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jump & Run</title>
<style>
body {
  margin: 0;
  background: #0f172a;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}
canvas {
  background: linear-gradient(#60a5fa, #e0f2fe);
  display: block;
  margin: 20px auto;
  border: 3px solid #020617;
}
button {
  padding: 12px 20px;
  font-size: 16px;
  margin: 10px;
  cursor: pointer;
}
</style>
</head>
<body>

<h2>Jump & Run</h2>
<canvas id="game" width="900" height="450"></canvas>

<div id="ui" style="display:none;">
  <h1>GAME OVER</h1>
  <button onclick="restart()">üîÑ Neustarten</button>
  <button onclick="location.href='../../index.html'">üè† Hub</button>
</div>

<script>
"use strict";

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRAVITY = 0.6;
const SPEED = 4;
const JUMP = 12;
const DASH_SPEED = 10;
const DASH_TIME = 10;

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

let cameraX = 0;

const player = {
  x: 100, y: 200, w: 40, h: 40,
  vx: 0, vy: 0,
  onGround: false,
  jumpsLeft: 2,
  dash: 0,
  lives: 3,
  kills: 0,
  distance: 0
};

let platforms = [{ x:0, y:380, w:600, h:40 }];
let enemies = [];
let lastPlatform = platforms[0];
let gameOver = false;

/* ---------- Utils ---------- */
function hit(a,b){
  return a.x<a.w+b.x&&a.x+a.w>b.x&&a.y<a.h+b.y&&a.y+a.h>b.y;
}

/* ---------- Generator ---------- */
function generate(){
  let last = platforms[platforms.length-1];
  while(last.x < cameraX + canvas.width + 300){
    const p = {
      x: last.x + last.w + 100 + Math.random()*120,
      y: 260 + Math.random()*120,
      w: 120,
      h: 20
    };
    platforms.push(p);

    const r = Math.random();
    if(r < 0.33){
      enemies.push({type:"walker",x:p.x+40,y:p.y-30,w:30,h:30,dir:1});
    } else if(r < 0.66){
enemies.push({
  type: "spike",
  x: p.x + 40,
  y: p.y - 120,   // nach oben verschieben!
  w: 30,
  h: 120
});
   enemies.push({type:"jumper",x:p.x+40,y:p.y-30,w:30,h:30,vy:0});
    }
    last = p;
  }
}

/* ---------- Player ---------- */
function updatePlayer(){
  let speed = SPEED;
  player.vx = 0;

  if(keys.a) player.vx = -speed;
  if(keys.d) player.vx = speed;

  if((keys.w||keys[" "]) && player.jumpsLeft>0){
    player.vy = -JUMP;
    player.jumpsLeft--;
    keys.w = keys[" "] = false;
  }

  if(keys.shift && player.dash===0){
    player.dash = DASH_TIME;
  }

  if(player.dash>0){
    player.vx = DASH_SPEED;
    player.dash--;
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;

  for(const p of platforms){
    if(player.x<p.x+p.w && player.x+player.w>p.x &&
       player.y+player.h<=p.y+10 && player.y+player.h+player.vy>=p.y){
      player.y = p.y-player.h;
      player.vy = 0;
      player.onGround = true;
      player.jumpsLeft = 2;
      lastPlatform = p;
    }
  }

  if(player.y > canvas.height){
    loseLife();
  }

  cameraX = player.x - 150;
  player.distance = Math.max(player.distance, Math.floor(player.x/50));
}

function loseLife(){
  player.lives--;
  if(player.lives<=0){
    gameOver = true;
    document.getElementById("ui").style.display="block";
    return;
  }
  player.x = lastPlatform.x + 20;
  player.y = lastPlatform.y - player.h;
  player.vy = 0;
}

/* ---------- Enemies ---------- */
function updateEnemies(){
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];

    if(e.type==="walker"){
      e.x += e.dir*1.5;
      if(Math.random()<0.01) e.dir*=-1;
    }

    if(e.type==="jumper"){
      e.vy += GRAVITY;
      e.y += e.vy;
      if(e.y>lastPlatform.y-30){
        e.vy = -8;
      }
    }

    if(hit(player,e)){
      if(e.type==="spike"){
        if(player.dash>0){
          enemies.splice(i,1);
          player.kills++;
        } else {
          loseLife();
        }
      } else if(player.vy>0){
        enemies.splice(i,1);
        player.vy = -8;
        player.kills++;
      } else {
        loseLife();
      }
    }
  }
}

/* ---------- Draw ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(-cameraX,0);

  ctx.fillStyle="#78350f";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  enemies.forEach(e=>{
    ctx.fillStyle = e.type==="spike"?"#7c2d12":"#dc2626";
    ctx.fillRect(e.x,e.y,e.w,e.h);
  });

  ctx.fillStyle="#1d4ed8";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  ctx.restore();

  ctx.fillStyle="#020617";
  ctx.fillText(`Leben: ${player.lives}`,20,20);
  ctx.fillText(`Gegner: ${player.kills}`,20,40);
  ctx.fillText(`Distanz: ${player.distance}`,20,60);
}

/* ---------- Loop ---------- */
function loop(){
  if(!gameOver){
    updatePlayer();
    updateEnemies();
    generate();
  }
  draw();
  requestAnimationFrame(loop);
}

function restart(){
  location.reload();
}

loop();
</script>
</body>
</html>

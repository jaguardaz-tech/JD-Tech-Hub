<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>2D Jump & Run</title>
<style>
  body {
    margin: 0;
    background: #0f172a;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
  }
  canvas {
    background: linear-gradient(#60a5fa, #e0f2fe);
    display: block;
    margin: 20px auto;
    border: 3px solid #020617;
  }
</style>
</head>
<body>

<h2>2D Jump & Run</h2>
<p>A/D = Laufen · W oder Space = Springen</p>
<canvas id="game" width="900" height="450"></canvas>

<script>
"use strict";

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRAVITY = 0.6;
const SPEED = 4;
const JUMP = 12;

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

const player = {
  x: 100,
  y: 200,
  w: 40,
  h: 40,
  vx: 0,
  vy: 0,
  onGround: false,
  lives: 3,
  destroyedEnemies: 0,
  distanceScore: 0
};

let cameraX = 0;
let lastSafePlatform = null;

let platforms = [
  { x: 0, y: 380, w: 600, h: 40 }
];

let enemies = [];

function rectsIntersect(a, b) {
  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    a.y < b.y + b.h &&
    a.y + a.h > b.y
  );
}

/* ---------- LEVEL GENERATOR ---------- */
function generatePlatforms() {
  let last = platforms[platforms.length - 1];
  while (last.x < cameraX + canvas.width + 300) {
    const gap = 80 + Math.random() * 120;
    const width = 100 + Math.random() * 120;
    const y = 260 + Math.random() * 120;

    const p = {
      x: last.x + last.w + gap,
      y,
      w: width,
      h: 20
    };

    platforms.push(p);

    if (Math.random() < 0.6) {
      enemies.push({
        x: p.x + p.w / 2 - 15,
        y: p.y - 30,
        w: 30,
        h: 30
      });
    }

    last = p;
  }
}

function cleanup() {
  platforms = platforms.filter(p => p.x + p.w > cameraX - 200);
  enemies = enemies.filter(e => e.x + e.w > cameraX - 200);
}

/* ---------- PLAYER ---------- */
function updatePlayer() {
  player.vx = 0;
  if (keys["a"]) player.vx = -SPEED;
  if (keys["d"]) player.vx = SPEED;

  if ((keys["w"] || keys[" "]) && player.onGround) {
    player.vy = -JUMP;
    player.onGround = false;
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;

  for (const p of platforms) {
    if (
      player.x < p.x + p.w &&
      player.x + player.w > p.x &&
      player.y + player.h <= p.y + 10 &&
      player.y + player.h + player.vy >= p.y
    ) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
      lastSafePlatform = p;
    }
  }

  if (player.y > canvas.height) {
    loseLife();
  }

  cameraX = player.x - 150;
  player.distanceScore = Math.max(player.distanceScore, Math.floor(player.x / 50));
}

function loseLife() {
  player.lives--;
  if (player.lives <= 0) return;

  if (lastSafePlatform) {
    player.x = lastSafePlatform.x + 20;
    player.y = lastSafePlatform.y - player.h;
  } else {
    player.x = cameraX + 100;
    player.y = 200;
  }

  player.vy = 0;
}

/* ---------- ENEMIES ---------- */
function updateEnemies() {
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];

    if (rectsIntersect(player, e)) {
      if (player.vy > 0 && player.y + player.h - e.y < 15) {
        enemies.splice(i, 1);
        player.vy = -8;
        player.destroyedEnemies++;
      } else {
        enemies.splice(i, 1);
        loseLife();
      }
    }
  }
}

/* ---------- DRAW ---------- */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(-cameraX, 0);

  ctx.fillStyle = "#78350f";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

  ctx.fillStyle = "#dc2626";
  enemies.forEach(e => ctx.fillRect(e.x, e.y, e.w, e.h));

  ctx.fillStyle = "#1d4ed8";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  ctx.restore();

  ctx.fillStyle = "#020617";
  ctx.fillText(`Leben: ${player.lives}`, 20, 30);
  ctx.fillText(`Zerstörte Gegner: ${player.destroyedEnemies}`, 20, 50);
  ctx.fillText(`Distanz-Punkte: ${player.distanceScore}`, 20, 70);

  if (player.lives <= 0) {
    ctx.font = "40px Arial";
    ctx.fillStyle = "red";
    ctx.fillText("GAME OVER", canvas.width / 2 - 120, canvas.height / 2);
  }
}

/* ---------- GAME LOOP ---------- */
function loop() {
  if (player.lives > 0) {
    updatePlayer();
    updateEnemies();
    generatePlatforms();
    cleanup();
  }
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
